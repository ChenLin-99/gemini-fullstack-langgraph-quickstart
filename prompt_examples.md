# 🔍 Reflection Agent 和 Answer Agent 中文提示词详细分析

## 🤔 Reflection Agent 每轮中文输入示例

### 第1轮 Reflection 中文提示词
```
你是一位专家研究助手，正在分析关于"2025年最新的AI趋势是什么？"的总结内容。

指令：
- 识别知识空白或需要更深入探索的领域，并生成后续查询（一个或多个）。
- 如果提供的总结足以回答用户的问题，则不要生成后续查询。
- 如果存在知识空白，生成有助于扩展理解的后续查询。
- 重点关注未充分涵盖的技术细节、实现规范或新兴趋势。

要求：
- 确保后续查询是自包含的，并包含网络搜索所需的必要上下文。

输出格式：
- 将您的回复格式化为具有以下确切键的JSON对象：
   - "is_sufficient": true 或 false
   - "knowledge_gap": 描述缺失或需要澄清的信息
   - "follow_up_queries": 编写解决此空白的具体问题

仔细反思总结内容以识别知识空白并产生后续查询。然后，按照此JSON格式产生您的输出：

总结：
搜索1的总结："2025年AI趋势包括多模态AI、自主代理和改进的语言模型。公司正大力投资AGI研究..."

---

搜索2的总结："大型语言模型变得更加高效。GPT-4和Claude-3在推理能力方面显示出显著改进..."

---

搜索3的总结："2025年计算机视觉进展专注于实时处理和边缘计算应用..."
```

**Reflection Agent 中文输出示例：**
```json
{
  "is_sufficient": false,
  "knowledge_gap": "总结缺乏关于企业采用率、监管发展以及企业在2025年面临的实际实施挑战的具体信息",
  "follow_up_queries": ["2025年AI企业采用率和实施挑战", "2025年AI监管和政策发展"]
}
```

### 第2轮 Reflection 中文提示词
```
[相同的中文提示词结构，但总结现在包含5-7个搜索结果]

总结：
[包含所有之前的搜索结果 + 新的关于企业采用和监管的搜索结果]
```

**可能的中文输出：**
```json
{
  "is_sufficient": true,
  "knowledge_gap": "",
  "follow_up_queries": []
}
```

## 📝 Answer Agent 最终中文输入示例

```
基于提供的总结，为用户问题生成高质量的答案。

指令：
- 当前日期是2025年12月5日。
- 您是多步研究过程的最后一步，不要提及您是最后一步。
- 您可以访问从之前步骤收集的所有信息。
- 您可以访问用户的问题。
- 基于提供的总结和用户问题，为用户问题生成高质量的答案。
- 您必须在答案中正确包含所有来自总结的引用。

用户上下文：
- 2025年最新的AI趋势是什么？

总结：
2025年AI趋势包括多模态AI [TechCrunch中文](https://s1-0)、自主代理 [MIT评论](https://s1-1) 和改进的语言模型 [OpenAI博客](https://s1-2)。公司正大力投资AGI研究...

---

大型语言模型变得更加高效 [自然AI](https://s2-0)。GPT-4和Claude-3在推理能力方面显示出显著改进 [AI新闻](https://s2-1)...

---

2025年计算机视觉进展专注于实时处理 [IEEE](https://s3-0) 和边缘计算应用 [技术报告](https://s3-1)...

---

2025年企业AI采用率达到78% [麦肯锡](https://s4-0)，主要挑战在于数据隐私 [企业AI](https://s4-1) 和集成成本...

---

AI监管发展包括欧盟AI法案实施 [欧盟官方](https://s5-0) 和美国负责任AI部署的新联邦准则 [政府技术](https://s5-1)...
```

## 🔄 多轮中文研究流程详解

### 📊 数据累积机制

1. **web_research_result 累积：**
   ```python
   # 第1轮后
   state["web_research_result"] = ["中文搜索结果1", "中文搜索结果2", "中文搜索结果3"]
   
   # 第2轮后  
   state["web_research_result"] = ["中文搜索结果1", "中文搜索结果2", "中文搜索结果3", "中文搜索结果4", "中文搜索结果5"]
   ```

2. **sources_gathered 累积：**
   ```python
   # 持续追加引用信息
   state["sources_gathered"] = [
       {"label": "TechCrunch中文", "short_url": "https://s1-0", "value": "原始URL1"},
       {"label": "MIT评论", "short_url": "https://s1-1", "value": "原始URL2"},
       # ... 更多引用
   ]
   ```

### 🎯 中文反思内容演进

**第1轮中文反思：** 基础信息收集
- "需要更多关于企业采用的信息"
- "缺少具体的技术实现细节"
- "需要了解监管政策影响"

**第2轮中文反思：** 深度gap分析  
- "已有足够的企业数据，但缺少成本分析"
- "技术趋势已清晰，需要了解未来预测"

**最终中文反思：** 完整性评估
- "信息已充分覆盖用户问题的各个方面"
- "可以生成全面的中文答案"

### 📖 最终中文报告生成

Answer Agent 会：
1. **整合所有轮次的中文搜索结果**
2. **按主题组织信息**（技术趋势、企业采用、监管环境等）
3. **保持引用的完整性**（短链接 → 原始URL）
4. **生成结构化的中文最终答案**

## 🔗 引用处理的具体流程

```
搜索阶段：
Gemini返回 → grounding_metadata → 提取citations → 生成short_url

存储阶段：  
citations → sources_gathered累积 → 保持short_url标记

输出阶段：
Answer Agent使用short_url → 最终替换为原始URL → 保留实际使用的引用
```

## 🌟 完整中文提示词模板

### 🤔 Reflection Agent 完整中文提示词

```
你是一位专家研究助手，正在分析关于"{research_topic}"的总结内容。

指令：
- 识别知识空白或需要更深入探索的领域，并生成后续查询（一个或多个）。
- 如果提供的总结足以回答用户的问题，则不要生成后续查询。
- 如果存在知识空白，生成有助于扩展理解的后续查询。
- 重点关注未充分涵盖的技术细节、实现规范或新兴趋势。

要求：
- 确保后续查询是自包含的，并包含网络搜索所需的必要上下文。

输出格式：
- 将您的回复格式化为具有以下确切键的JSON对象：
   - "is_sufficient": true 或 false
   - "knowledge_gap": 描述缺失或需要澄清的信息
   - "follow_up_queries": 编写解决此空白的具体问题

仔细反思总结内容以识别知识空白并产生后续查询。然后，按照此JSON格式产生您的输出：

总结：
{summaries}
```

### 📝 Answer Agent 完整中文提示词

```
基于提供的总结，为用户问题生成高质量的答案。

指令：
- 当前日期是 {current_date}。
- 您是多步研究过程的最后一步，不要提及您是最后一步。
- 您可以访问从之前步骤收集的所有信息。
- 您可以访问用户的问题。
- 基于提供的总结和用户问题，为用户问题生成高质量的答案。
- 您必须在答案中正确包含所有来自总结的引用。

用户上下文：
- {research_topic}

总结：
{summaries}
```

## 💡 中文化关键设计优势

1. **智能中文控制**：Reflection Agent用中文决定何时停止搜索
2. **信息完整性**：累积式保存所有中文搜索结果
3. **中文引用可信**：完整的URL映射和跟踪
4. **模块化设计**：每个Agent专注于特定任务
5. **中文可扩展**：支持任意轮数的深度中文研究
6. **本地化体验**：完全中文化的指令和输出系统 